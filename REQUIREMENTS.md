# 多语言智能翻译引擎 - 需求分析文档

## 1. 文档概述

### 1.1 文档目的
本文档详细描述基于 Ollama 的多语言智能翻译引擎的功能需求、非功能需求和约束条件,为系统设计和开发提供明确的指导。

### 1.2 文档范围
- 功能需求描述
- 非功能需求定义
- 用户角色与使用场景
- 系统约束条件
- 需求优先级划分

### 1.3 术语定义

| 术语 | 定义 |
|-----|------|
| Ollama | 本地大语言模型运行平台 |
| LLM | Large Language Model,大语言模型 |
| 源语言 | 待翻译文本的原始语言 |
| 目标语言 | 翻译后输出的语言 |
| 术语对照表 | 专业领域词汇的翻译映射表 |
| 分段翻译 | 将长文本分割成多个段落分别翻译 |
| 重叠区域 | 分段翻译中相邻段落的重复部分,用于保持上下文连贯性 |
| 摘要生成 | 对翻译结果进行简短总结的功能 |
| 语言检测 | 自动识别文本所使用的语言 |

---

## 2. 项目背景

### 2.1 业务背景
随着全球化的发展,跨语言沟通需求日益增长。现有的在线翻译服务存在以下问题:
- 隐私安全隐患(需要上传文本到云端)
- 专业领域翻译质量不佳
- 批量处理能力有限
- 无法自定义专业术语

### 2.2 项目目标
构建一个基于本地大模型的智能翻译引擎,实现:
- **隐私保护**:所有翻译在本地完成,数据不上传
- **专业定制**:支持专业领域和术语表定制
- **批量处理**:支持批量文件翻译
- **灵活配置**:丰富的配置选项
- **标准输出**:统一的 JSON 格式输出

### 2.3 目标用户

| 用户类型 | 描述 | 主要需求 |
|---------|------|---------|
| 技术文档作者 | 需要翻译技术文档、API 文档等 | 准确的技术术语翻译,批量处理 |
| 法律从业者 | 需要翻译合同、法律文件 | 法律专业术语支持,高准确性 |
| 医疗研究人员 | 需要翻译医学论文、报告 | 医学术语对照,专业性保障 |
| 内容创作者 | 需要翻译文章、博客 | 保持原文风格,流畅表达 |
| 企业用户 | 需要翻译内部文档 | 批量处理,数据安全 |

---

## 3. 功能需求

### 3.1 核心功能

#### FR1: 自动语言检测
**需求描述**:系统应能自动检测待翻译文本的源语言。

**功能细节**:
- 支持至少 30 种主流语言检测
- 基于大语言模型进行智能识别
- 使用中文标注语言名称
- 对超长文本进行智能采样(前 500 字符)
- 提供缓存机制避免重复检测

**输入**:
- 待检测文本(字符串)

**输出**:
- 检测到的语言名称(中文标注)

**验收标准**:
- 能正确识别常见语言(英语、中文、日语、韩语等)
- 检测准确率 >= 95%
- 缓存命中率统计功能正常

**优先级**: P0(必须有)

---

#### FR2: 单文本翻译
**需求描述**:系统应能将输入的文本翻译成目标语言。

**功能细节**:
- 支持指定目标语言
- 自动检测源语言
- 支持专业领域定制(医疗、法律、计算机等)
- 支持术语对照表定制
- 保持原文语气和风格
- 输出标准 JSON 格式结果

**输入**:
- 待翻译文本(字符串)
- 目标语言(可选,默认为中文)
- 专业领域(可选)
- 术语对照表(可选,支持 Key=Value 或 JSON 格式)

**输出**:
```json
{
  "detected_language": "英语",
  "translated_text": "翻译后的文本",
  "summary": "摘要内容(可选)"
}
```

**验收标准**:
- 翻译准确流畅
- 正确使用术语对照表
- 输出格式符合 JSON 规范
- 错误时返回包含 error 字段的 JSON

**优先级**: P0(必须有)

---

#### FR3: 长文本分段翻译
**需求描述**:系统应能智能处理长文本,通过分段翻译避免超出模型处理能力。

**功能细节**:
- 自动检测文本长度,超过阈值时启用分段
- 按句子边界分割(句号、问号、感叹号等)
- 支持段落重叠配置(默认 100 字符)
- 智能合并翻译结果,去除重复内容
- 在句子边界处合并,避免语义不完整

**输入**:
- 长文本(字符串)
- 分段配置(最大长度、重叠字符数)

**输出**:
- 完整的翻译结果(合并后)

**验收标准**:
- 分段点在句子边界
- 合并后文本连贯,无明显重复
- 支持配置可调

**优先级**: P0(必须有)

---

#### FR4: 摘要生成
**需求描述**:系统应为翻译结果生成简短摘要。

**功能细节**:
- 可配置启用/禁用
- 摘要长度可配置(默认 100 字)
- 使用目标语言生成摘要
- 对超长文本采样生成(前 1000 字符)
- 支持自定义摘要 Prompt 模板

**输入**:
- 翻译后的文本
- 目标语言

**输出**:
- 摘要文本(字符串)

**验收标准**:
- 摘要准确概括主要内容
- 长度控制在配置范围内
- 语言流畅简洁

**优先级**: P1(重要)

---

#### FR5: 批量文件翻译
**需求描述**:系统应能批量处理指定目录中的文件。

**功能细节**:
- 支持指定输入/输出目录
- 支持文件匹配模式(Glob 模式,如 *.txt)
- 为每个文件生成独立的 JSON 翻译结果
- 输出文件命名:原文件名_translated.扩展名
- 提供详细的处理统计(成功数、失败数等)
- 支持原文件归档或删除

**输入**:
- 输入目录路径
- 输出目录路径
- 文件匹配模式
- 翻译参数(目标语言、领域、术语等)

**输出**:
```json
{
  "total_files": 10,
  "success_count": 9,
  "failed_count": 1,
  "results": [
    {
      "input_file": "文件路径",
      "output_file": "输出文件路径",
      "status": "success/failed/skipped",
      "error": "错误信息(如有)",
      "translation": {...}
    }
  ],
  "message": "批量翻译完成：成功 9 个,失败 1 个"
}
```

**验收标准**:
- 能正确遍历和处理所有匹配文件
- 单个文件失败不影响其他文件
- 统计信息准确
- 原文件处理符合配置(归档/删除)

**优先级**: P0(必须有)

---

#### FR6: 专业领域定制
**需求描述**:系统应支持专业领域定制,提升特定领域翻译质量。

**功能细节**:
- 支持常见领域:医疗、法律、计算机、文学、金融等
- 在 Prompt 中注入领域信息
- 引导模型使用领域专业术语和表达方式

**输入**:
- 领域名称(字符串)

**输出**:
- 优化后的翻译结果

**验收标准**:
- 专业术语翻译更准确
- 符合领域表达习惯

**优先级**: P1(重要)

---

#### FR7: 术语对照表定制
**需求描述**:系统应支持术语对照表,确保特定词汇的准确翻译。

**功能细节**:
- 支持 Key=Value 格式输入(如:AI=人工智能)
- 支持 JSON 格式输入
- 支持多个术语(逗号分隔)
- 在 Prompt 中强制要求使用术语对照表
- 自动解析和格式化术语表

**输入**:
- 术语表字符串(Key=Value 或 JSON)

**输出**:
- 应用术语对照表的翻译结果

**验收标准**:
- 术语翻译严格对照表执行
- 支持多个术语同时使用
- 格式容错能力强

**优先级**: P1(重要)

---

### 3.2 辅助功能

#### FR8: 语言检测缓存
**需求描述**:系统应缓存语言检测结果,避免重复调用 LLM。

**功能细节**:
- 使用文本 MD5 哈希作为缓存键
- 可配置启用/禁用缓存
- 提供缓存统计信息查询
- 支持手动清除缓存

**输入**:
- 待检测文本

**输出**:
- 缓存命中时直接返回结果
- 缓存未命中时调用 LLM 并缓存

**验收标准**:
- 缓存键计算正确(MD5)
- 缓存命中时返回相同结果
- 缓存统计准确

**优先级**: P2(可选)

---

#### FR9: 配置文件管理
**需求描述**:系统应支持通过配置文件管理所有配置项。

**功能细节**:
- 使用 YAML 格式配置文件
- 支持 Ollama 服务配置(地址、端口、模型等)
- 支持翻译参数配置(温度、Top-p、最大 Token 等)
- 支持分段翻译配置
- 支持摘要生成配置
- 支持文件管理配置
- 支持命令行参数覆盖配置

**输入**:
- YAML 配置文件路径

**输出**:
- 加载后的配置字典

**验收标准**:
- 配置文件格式正确
- 所有配置项可正常加载
- 配置缺失时使用合理默认值

**优先级**: P0(必须有)

---

#### FR10: 错误处理与重试
**需求描述**:系统应具备完善的错误处理和重试机制。

**功能细节**:
- API 调用超时自动重试(指数退避)
- 可配置最大重试次数
- 区分可重试错误和不可重试错误
- 所有错误以标准 JSON 格式输出
- 详细的日志记录

**输入**:
- API 请求

**输出**:
- 成功时返回翻译结果
- 失败时返回包含 error 字段的 JSON

**验收标准**:
- 超时错误正确重试
- 连接错误正确终止
- 错误信息清晰明确

**优先级**: P0(必须有)

---

#### FR11: 命令行接口
**需求描述**:系统应提供友好的命令行接口。

**功能细节**:
- 支持单文本模式和批量模式
- 丰富的命令行参数
- 参数验证和帮助信息
- 支持自定义配置文件路径
- 支持批量配置文件

**输入**:
- 命令行参数

**输出**:
- JSON 格式翻译结果

**验收标准**:
- 参数解析正确
- 帮助信息清晰
- 错误参数有友好提示

**优先级**: P0(必须有)

---

#### FR12: 日志记录
**需求描述**:系统应提供详细的日志记录,便于调试和监控。

**功能细节**:
- 记录关键流程节点
- 记录 API 调用信息
- 记录错误和警告
- 可配置日志级别
- 时间戳格式化输出

**输入**:
- 系统运行过程中的各类事件

**输出**:
- 格式化的日志信息

**验收标准**:
- 日志信息完整
- 日志格式统一
- 关键节点都有日志

**优先级**: P1(重要)

---

## 4. 非功能需求

### 4.1 性能需求

#### NFR1: 响应时间
- 单文本翻译(短文本, < 500 字符): <= 10 秒
- 单文本翻译(中等文本, 500-2000 字符): <= 30 秒
- 单文本翻译(长文本, > 2000 字符): 根据分段数量线性增长
- 语言检测: <= 5 秒

#### NFR2: 吞吐量
- 批量翻译:支持至少 100 个文件连续处理
- 无内存泄漏问题

#### NFR3: 并发
- 当前版本不支持并发
- 未来版本考虑支持多线程/异步处理

---

### 4.2 可靠性需求

#### NFR4: 错误处理
- 所有异常情况都有处理
- 错误信息清晰明确
- 系统崩溃后能正常重启

#### NFR5: 数据完整性
- 翻译结果完整保存
- JSON 输出格式正确
- 特殊字符正确转义

#### NFR6: 容错能力
- 单个文件翻译失败不影响其他文件
- API 调用失败自动重试
- 配置文件缺失有默认值

---

### 4.3 可用性需求

#### NFR7: 易用性
- 命令行参数设计直观
- 提供详细的使用示例和帮助信息
- 错误提示友好清晰

#### NFR8: 可配置性
- 所有关键参数可配置
- 支持配置文件和命令行参数
- 配置项有合理默认值

#### NFR9: 可维护性
- 代码结构清晰,模块化设计
- 详细的注释和文档
- 日志信息完整

---

### 4.4 兼容性需求

#### NFR10: 平台兼容性
- 支持 Windows、Linux、macOS
- 依赖 Python 3.7+

#### NFR11: 依赖兼容性
- Ollama 服务(需单独安装)
- Python 库:requests, pyyaml

#### NFR12: 数据格式兼容性
- 配置文件:YAML 格式
- 输出文件:JSON 格式
- 输入文件:UTF-8 编码的文本文件

---

### 4.5 安全性需求

#### NFR13: 数据隐私
- 所有翻译在本地完成,数据不上传
- 原文件可安全删除或归档
- 不记录敏感信息到日志

#### NFR14: 输入验证
- 验证输入文件存在性
- 验证目录权限
- 验证配置文件格式

#### NFR15: 权限控制
- 文件操作遵循系统权限
- 不越权访问文件

---

### 4.6 可扩展性需求

#### NFR16: 语言扩展
- 易于添加新的语言支持
- 语言映射表集中管理

#### NFR17: 功能扩展
- 模块化设计便于添加新功能
- Prompt 模板化便于定制

#### NFR18: 配置扩展
- 支持添加新的配置项
- 向后兼容旧版本配置

---

## 5. 用户场景

### 5.1 场景一:开发者翻译技术文档

**用户角色**:技术文档作者

**场景描述**:
开发者编写了一份英文的 API 使用指南,需要翻译成中文发布给国内用户。

**用户目标**:
- 准确翻译技术术语(API、endpoint、authentication 等)
- 保持技术文档的专业性
- 快速完成翻译

**操作流程**:
1. 准备术语对照表:API=接口,endpoint=端点,authentication=认证
2. 执行命令:
```bash
python translator_main.py --text "This API provides authentication..." \
  --domain "计算机科学" \
  --glossary "API=接口,endpoint=端点,authentication=认证"
```
3. 获取 JSON 格式翻译结果
4. 复制翻译结果到文档

**需求满足**:
- ✓ FR2: 单文本翻译
- ✓ FR6: 专业领域定制
- ✓ FR7: 术语对照表定制

---

### 5.2 场景二:法务部门批量翻译合同

**用户角色**:法务从业者

**场景描述**:
公司有一批英文合同文件需要翻译成中文,用于内部审查。

**用户目标**:
- 批量处理所有合同文件
- 确保法律术语准确翻译
- 保留原文件以备查

**操作流程**:
1. 将所有合同文件放入 ./contracts 目录
2. 配置术语对照表:contract=合同,party=方,obligation=义务
3. 执行批量翻译:
```bash
python translator_main.py --batch \
  --input_dir ./contracts \
  --output_dir ./contracts_translated \
  --domain "法律" \
  --glossary "contract=合同,party=方,obligation=义务" \
  --no_delete
```
4. 检查输出目录中的翻译结果
5. 原文件自动归档到 ./archive 目录

**需求满足**:
- ✓ FR5: 批量文件翻译
- ✓ FR6: 专业领域定制
- ✓ FR7: 术语对照表定制
- ✓ FR9: 配置文件管理

---

### 5.3 场景四:研究者翻译学术论文

**用户角色**:医疗研究人员

**场景描述**:
研究人员需要翻译一篇关于临床试验的英文医学论文。

**用户目标**:
- 准确翻译医学术语
- 生成论文摘要
- 保持学术表达风格

**操作流程**:
1. 准备论文文本
2. 执行翻译:
```bash
python translator_main.py --text "Clinical trials demonstrate..." \
  --target_lang "Chinese" \
  --domain "医疗" \
  --glossary "Clinical trials=临床试验,patients=患者,efficacy=疗效" \
  --summary
```
3. 获取包含摘要的翻译结果

**需求满足**:
- ✓ FR2: 单文本翻译
- ✓ FR4: 摘要生成
- ✓ FR6: 专业领域定制
- ✓ FR7: 术语对照表定制

---

### 5.4 场景四:企业日常文档处理

**用户角色**:企业行政人员

**场景描述**:
公司每天收到大量外文邮件和文档,需要快速了解内容。

**用户目标**:
- 快速翻译文档
- 生成摘要以便快速了解内容
- 批量处理提高效率

**操作流程**:
1. 将所有文档放入 ./inbox 目录
2. 执行批量翻译:
```bash
python translator_main.py --batch \
  --input_dir ./inbox \
  --output_dir ./translated \
  --summary
```
3. 查看翻译结果和摘要

**需求满足**:
- ✓ FR4: 摘要生成
- ✓ FR5: 批量文件翻译
- ✓ FR8: 语言检测缓存(加速处理)

---

## 6. 系统约束

### 6.1 技术约束

#### TC1: 依赖 Ollama 服务
- 系统必须依赖本地运行的 Ollama 服务
- Ollama 服务必须先于翻译引擎启动
- 支持的模型取决于 Ollama 安装的模型

#### TC2: Python 版本
- 最低支持 Python 3.7
- 推荐 Python 3.9+

#### TC3: 文件格式限制
- 当前仅支持 UTF-8 编码的纯文本文件
- 不支持 PDF、DOCX 等格式(需扩展)

---

### 6.2 业务约束

#### BC1: 本地部署
- 系统必须在本地运行,不提供云服务
- 用户需要自行安装和维护 Ollama

#### BC2: 配置要求
- 用户需要提供配置文件
- 配置错误会导致程序退出

---

### 6.3 运行环境约束

#### EC1: 硬件要求
- CPU:支持现代 CPU 指令集
- 内存:至少 8GB RAM(取决于 Ollama 模型大小)
- 磁盘:至少 10GB 可用空间(模型存储)

#### EC2: 网络要求
- 不需要互联网连接(完全离线运行)
- Ollama 服务通过 localhost 访问

---

## 7. 需求优先级

### 7.1 优先级定义

| 优先级 | 说明 | 包含需求 |
|-------|------|---------|
| P0 | 必须有,核心功能 | FR1, FR2, FR3, FR5, FR9, FR10, FR11 |
| P1 | 重要,显著提升用户体验 | FR4, FR6, FR7, FR12 |
| P2 | 可选,锦上添花 | FR8 |

### 7.2 实施路线图

#### 第一阶段(MVP)
- 实现所有 P0 需求
- 核心翻译功能可用
- 基本的批量处理

#### 第二阶段
- 实现所有 P1 需求
- 提升翻译质量和用户体验
- 完善日志和错误处理

#### 第三阶段
- 实现 P2 需求
- 性能优化
- 功能增强

---

## 8. 验收标准

### 8.1 功能验收

#### AC1: 语言检测
- [ ] 能正确识别至少 30 种语言
- [ ] 检测准确率 >= 95%
- [ ] 缓存功能正常

#### AC2: 单文本翻译
- [ ] 能翻译至少 1000 字符的文本
- [ ] 翻译结果准确流畅
- [ ] JSON 输出格式正确
- [ ] 术语对照表生效

#### AC3: 长文本分段翻译
- [ ] 能处理 10000 字符以上的长文本
- [ ] 分段点在句子边界
- [ ] 合并后文本连贯无重复

#### AC4: 批量翻译
- [ ] 能处理至少 100 个文件
- [ ] 单个文件失败不影响其他文件
- [ ] 统计信息准确
- [ ] 原文件处理正确

---

### 8.2 性能验收

#### AC5: 响应时间
- [ ] 短文本翻译 <= 10 秒
- [ ] 语言检测 <= 5 秒

#### AC6: 稳定性
- [ ] 连续翻译 100 个文件无崩溃
- [ ] 内存占用稳定

---

### 8.3 非功能验收

#### AC7: 易用性
- [ ] 命令行参数直观
- [ ] 帮助信息清晰
- [ ] 错误提示友好

#### AC8: 可维护性
- [ ] 代码结构清晰
- [ ] 注释完整
- [ ] 日志详细

---

## 9. 风险分析

### 9.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|-----|------|------|---------|
| Ollama 服务不稳定 | 高 | 中 | 完善重试机制,提供清晰错误提示 |
| 模型翻译质量不佳 | 高 | 低 | 支持术语表和领域定制,允许用户切换模型 |
| 长文本处理超时 | 中 | 中 | 分段翻译,增加超时配置 |

### 9.2 业务风险

| 风险 | 影响 | 概率 | 缓解措施 |
|-----|------|------|---------|
| 用户配置错误导致无法使用 | 中 | 高 | 提供配置示例,详细文档,参数验证 |
| 批量处理时误删文件 | 高 | 低 | 默认归档而非删除,确认提示 |

### 9.3 性能风险

| 风险 | 影响 | 概率 | 缓解措施 |
|-----|------|------|---------|
| 大批量文件处理时间过长 | 低 | 中 | 提供进度提示,建议分批处理 |
| 内存占用过高 | 中 | 低 | 分段翻译,优化缓存策略 |

---

## 10. 未来需求展望

### 10.1 功能扩展

#### FE1: 支持更多文件格式
- PDF 文档翻译
- Word 文档翻译
- Markdown 文档翻译
- Excel 表格翻译

#### FE2: 并发处理
- 多线程翻译加速
- 异步批量处理
- 进度条显示

#### FE3: 翻译记忆
- 保存翻译历史
- 相似文本复用翻译结果
- 术语库管理

#### FE4: API 服务模式
- 提供 REST API 接口
- 支持 Web UI
- 支持第三方集成

---

### 10.2 质量提升

#### FE5: 翻译质量评估
- 自动评估翻译质量
- 提供置信度评分
- 标记不确定的翻译

#### FE6: 后编辑支持
- 支持人工修正翻译
- 修正结果反馈到模型
- 学习用户偏好

---

### 10.3 用户体验

#### FE7: 可视化界面
- Web UI 界面
- 桌面应用程序
- 实时翻译预览

#### FE8: 协作功能
- 多用户协作翻译
- 翻译任务分配
- 审核流程

---

## 11. 需求变更管理

### 11.1 变更流程
1. 提出变更请求
2. 评估变更影响
3. 更新需求文档
4. 更新设计文档
5. 实施变更
6. 测试验证

### 11.2 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|-----|------|---------|-------|
| 1.0 | 2025-12-30 | 初始版本 | Claude Code |

---

## 附录

### A. 支持的语言列表

1. 英语/英文/English
2. 中文/Chinese
3. 日语/Japanese
4. 韩语/Korean
5. 法语/French
6. 德语/German
7. 西班牙语/Spanish
8. 俄语/Russian
9. 阿拉伯语/Arabic
10. 葡萄牙语/Portuguese
11. 意大利语/Italian
12. 荷兰语/Dutch
13. 波兰语/Polish
14. 土耳其语/Turkish
15. 泰语/Thai
16. 越南语/Vietnamese
17. 印尼语/Indonesian
18. 马来语/Malay
19. 希腊语/Greek
20. 捷克语/Czech
21. 瑞典语/Swedish
22. 丹麦语/Danish
23. 挪威语/Norwegian
24. 芬兰语/Finnish
25. 匈牙利语/Hungarian
26. 罗马尼亚语/Romanian
27. 保加利亚语/Bulgarian
28. 乌克兰语/Ukrainian
29. 希伯来语/Hebrew
30. 印地语/Hindi
31. 孟加拉语/Bengali
32. 乌尔都语/Urdu
33. 波斯语/Persian

### B. 配置文件示例

详见 [DESIGN.md](./DESIGN.md) 第 5 节。

### C. 使用示例

详见 [DESIGN.md](./DESIGN.md) 第 12 节。

---

**文档版本**: 1.0
**最后更新**: 2025-12-30
**作者**: Claude Code
**项目**: 基于 Ollama 的多语言智能翻译引擎
